---
title: | 
  | \vspace{5cm} \LARGE{CP-1 Part 1: ISyE 6404}
  
author:
- Yuan Gao, Kevin Lee, Akshay Govindaraj
- Yijun (Emma) Wan, Peter Williams, Ruixuan Zhang
- ygao390, kylee20, ywan40, agovindaraj6, pwilliams60, rzhang438 | @gatech.edu

date: "`r Sys.Date()`"
output:
   pdf_document:
      fig_caption: true
      number_sections: false
---

\newpage
\tableofcontents

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Workload Distribution

Below is a description of tasks and the distribution of work (%) by team member for this project:  

\begin{center}
\begin{tabular}{ |l|l| } 
\hline
Team Member & Task Description  \\
\hline
Yuan Gao & TBD \\ 
Kevin Lee & TBD  \\ 
Akshay Govindaraj & TBD  \\ 
Yijun (Emma) Wan & TBD  \\ 
Peter Williams & TBD  \\ 
Ruixuan Zhang & TBD \\ 
\hline
\end{tabular}
\end{center}

\newpage

## PH-Regression Data-Fit

#### Dataset intro

#### Tasks
1) Locate a data set in the field of your interest, e.g., eCommerce, medical study, drug development, supply-chain/logistics operations, to practice the PH-regression technique. Note that we need to predict both hazard-rate and the survival function at an input x0.

```{r data, echo = T, include = T, fig.align='center',fig.height=4}
library("survival")
library("survminer")
data("kidney")
head(kidney)
```
For this exercise, I located a dataset in the survival package, that describes the recurrence times to infection, at the point of insertion of the catheter, for kidney patients using portable dialysis equipment. Catheters may be removed for reasons other than infection, in which case the observation is censored. Each patient has exactly 2 observations. It has seven variables:

1)patient: id

2)time:	time

3)status:	event status

4)age:	in years

5)sex:	1=male, 2=female

6)disease:	disease type (0=GN, 1=AN, 2=PKD, 3=Other)

7)frail:	frailty estimate from original paper

First, I compute the univariate Cox analyses for the four variables; then weâ€™ll fit multivariate cox analyses using two variables to describe how the factors jointly impact on survival.
```{r PH-regression_un, echo = T, include = T, fig.align='center',fig.height=4}
res.cox <- coxph(Surv(time, status) ~ age, data = kidney)
res.cox
res.cox.zph <- cox.zph(res.cox)
res.cox.zph
res.cox <- coxph(Surv(time, status) ~ sex, data = kidney)
res.cox
res.cox.zph <- cox.zph(res.cox)
res.cox.zph
res.cox <- coxph(Surv(time, status) ~ disease, data = kidney)
res.cox
res.cox.zph <- cox.zph(res.cox)
res.cox.zph
res.cox <- coxph(Surv(time, status) ~ frail, data = kidney)
res.cox
res.cox.zph <- cox.zph(res.cox)
res.cox.zph
```

The syntax above gives us the method to get the survival function of any given variables.The output above shows the regression beta coefficients, the effect sizes (given as hazard ratios) and statistical significance for each of the variables in relation to overall survival.

Following is the Cox regression results Analysis:

1) Statistical significance, z, gives the Wald statistic value,evaluates whether the beta coefficient of a given variable is statistically significantly different from 0. From the output above, we can conclude that the variable sex and frail have highly statistically significant coefficients, but age and disease don't. So, following we focus on the sex and frail.

2) The regression coefficients are positive signs meaning that the hazard (risk of death) is higher, and thus the prognosis worse, for subjects with higher values of that variable.

3) Hazard ratios are the exponentiated coefficients (exp(coef)) which give the effect size of the variable age. 
So, it gives us the predict about the hazard ratio for any given variables. The variable sex is encoded as a numeric vector. 1: male, 2: female. The beta coefficient for sex = -0.838 indicates that females have lower risk of kidney (lower survival rates) than males, in these data.

4) Confidence intervals of the hazard ratios is shown by the upper and lower 95% confidence intervals for the hazard ratio (exp(coef)).

5) Global statistical significance p-values for three alternative tests for overall significance of the model: The likelihood-ratio test, Wald test, and score logrank statistics. These three methods are asymptotically equivalent.

6) cox.zph() function shows the data are sufficiently consistent with the assumption of proportional hazards with respect to each of the variables separately as well as globally.
```{r PH-regression_plot, echo = T, include = T, fig.align='center',fig.height=4}
library(survminer)
res.cox <- coxph(Surv(time, status) ~ sex+frail, data =  kidney)
ggsurvplot(survfit(res.cox), data = kidney, palette = "#2E9FDF",ggtheme = theme_minimal())
new_dat = data.frame(sex = c(1), frail = c(2))
survfit(res.cox, newdata = new_dat)
```
The picture is to visualize the predicted survival proportion at any given point for a particular risk group. Besides, the syntax above is to make predict about the survival interval of any given new data.

2) Follow Task #4 in EP-2 to construct a 90% pointwise confidence interval based only the bootstrap method.
3) Skim through the CP-1 references given in Files> Projects> CP-1> Reference> directory to write a two-page report for summarizing the work there.
4) Outline steps for implementing one of the studied procedure addressed in the reference. You DO NOT need to implement them, but describe how to do it.
5) Discuss whether the results getting in (2) and (4) might be different (in what way).


